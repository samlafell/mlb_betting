<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MLB Betting System - Enhanced Dashboard</title>
    
    <!-- Widget System Styles -->
    <link rel="stylesheet" href="/static/css/widget-system.css">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0f172a;
            color: #e2e8f0;
            line-height: 1.6;
        }
        .header {
            background: #1e293b;
            padding: 1rem 2rem;
            border-bottom: 2px solid #334155;
            display: flex;
            justify-content: between;
            align-items: center;
        }
        .header h1 { color: #60a5fa; }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-healthy { background: #10b981; }
        .status-warning { background: #f59e0b; }
        .status-critical { background: #ef4444; }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }
        .card {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .card h3 {
            color: #60a5fa;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
        }
        .metric {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #374151;
        }
        .metric:last-child { border-bottom: none; }
        .metric-value {
            font-weight: bold;
            color: #10b981;
        }
        .pipeline-item {
            background: #374151;
            border-radius: 4px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .pipeline-item:last-child { margin-bottom: 0; }
        .pipeline-status {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.875rem;
            font-weight: bold;
        }
        .status-running { background: #3b82f6; color: white; }
        .status-success { background: #10b981; color: white; }
        .status-failed { background: #ef4444; color: white; }
        .status-pending { background: #6b7280; color: white; }
        .loading {
            text-align: center;
            padding: 2rem;
            color: #6b7280;
        }
        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-size: 0.875rem;
            font-weight: bold;
        }
        .connected { background: #10b981; color: white; }
        .disconnected { background: #ef4444; color: white; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üèà MLB Betting System Dashboard</h1>
        <div style="display: flex; align-items: center; gap: 2rem;">
            <nav style="display: flex; gap: 1rem;">
                <a href="/" style="color: #60a5fa; text-decoration: none; padding: 0.5rem 1rem; border-radius: 4px; background: #374151;">Enhanced Dashboard</a>
                <a href="/analytics" style="color: #e2e8f0; text-decoration: none; padding: 0.5rem 1rem; border-radius: 4px; background: #1e293b; border: 1px solid #374151;">üìä Advanced Analytics</a>
            </nav>
            <div id="systemStatus">
                <span class="status-indicator status-healthy"></span>
                <span>System Healthy</span>
            </div>
        </div>
    </div>
    
    <!-- Dashboard Toolbar -->
    <div class="dashboard-toolbar">
        <div class="dashboard-title">Customizable Widget Dashboard</div>
        <div class="dashboard-actions">
            <button class="layout-preset-btn" data-preset="default">Default</button>
            <button class="layout-preset-btn" data-preset="monitoring">Monitoring</button>
            <button class="layout-preset-btn" data-preset="betting">Betting</button>
            <button class="layout-preset-btn" data-preset="analytics">Analytics</button>
            <button class="layout-preset-btn" data-preset="minimal">Minimal</button>
            <button id="add-widget-btn" class="btn-primary">+ Add Widget</button>
            <button id="dashboard-settings-btn" class="btn-secondary">‚öôÔ∏è Settings</button>
        </div>
    </div>
    
    <div class="connection-status disconnected" id="connectionStatus">
        Connecting...
    </div>
    
    <!-- Enhanced Widget Container -->
    <div class="dashboard-container" id="dashboardContainer">
        <!-- Widgets will be dynamically generated by the Widget Manager -->
    </div>

    <!-- Enhanced Dashboard System -->
    <script src="/static/js/widget-manager.js"></script>
    <script src="/static/js/mobile-optimizer.js"></script>
    <script src="/static/js/performance-optimizer.js"></script>
    
    <script>
        class EnhancedMonitoringDashboard {
            constructor() {
                this.ws = null;
                this.reconnectAttempts = 0;
                this.maxReconnectAttempts = 5;
                this.reconnectInterval = 5000;
                this.widgetManager = null;
                this.mobileOptimizer = null;
                this.performanceOptimizer = null;
                
                this.initializePerformanceOptimizer();
                this.initializeMobileOptimizer();
                this.initializeWidgetSystem();
                this.initializeWebSocket();
                this.setupWidgetRefreshHandlers();
                this.loadInitialData();
            }
            
            initializePerformanceOptimizer() {
                this.performanceOptimizer = new PerformanceOptimizer();
                window.performanceOptimizer = this.performanceOptimizer;
            }
            
            initializeMobileOptimizer() {
                this.mobileOptimizer = new MobileOptimizer();
                window.mobileOptimizer = this.mobileOptimizer;
            }
            
            initializeWidgetSystem() {
                const dashboardContainer = document.getElementById('dashboardContainer');
                this.widgetManager = new WidgetManager(dashboardContainer);
                
                // Make widget manager globally accessible
                window.widgetManager = this.widgetManager;
                
                // Apply layout presets
                document.querySelectorAll('.layout-preset-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        // Update active state
                        document.querySelectorAll('.layout-preset-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        
                        // Apply preset
                        this.widgetManager.applyLayoutPreset(e.target.dataset.preset);
                    });
                });
                
                // Set default preset as active
                document.querySelector('.layout-preset-btn[data-preset="default"]')?.classList.add('active');
            }
            
            setupWidgetRefreshHandlers() {
                // Listen for widget refresh events
                document.addEventListener('widgetRefresh', (e) => {
                    const { widgetId } = e.detail;
                    this.refreshSpecificWidget(widgetId);
                });
            }
            
            refreshSpecificWidget(widgetId) {
                switch(widgetId) {
                    case 'system-health':
                        this.loadSystemHealthWidget();
                        break;
                    case 'active-pipelines':
                        this.loadActivePipelinesWidget();
                        break;
                    case 'performance-metrics':
                        this.loadPerformanceMetricsWidget();
                        break;
                    case 'recent-activity':
                        this.loadRecentActivityWidget();
                        break;
                    case 'opportunities':
                        this.loadOpportunitiesWidget();
                        break;
                    case 'line-movement':
                        this.loadLineMovementWidget();
                        break;
                    case 'alerts':
                        this.loadAlertsWidget();
                        break;
                    case 'quick-stats':
                        this.loadQuickStatsWidget();
                        break;
                    default:
                        console.warn(`Unknown widget refresh requested: ${widgetId}`);
                }
            }
            
            initializeWebSocket() {
                const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
                const wsUrl = `${protocol}//${window.location.host}/ws`;
                
                this.ws = new WebSocket(wsUrl);
                
                this.ws.onopen = () => {
                    console.log('WebSocket connected');
                    this.updateConnectionStatus(true);
                    this.reconnectAttempts = 0;
                };
                
                this.ws.onmessage = (event) => {
                    const message = JSON.parse(event.data);
                    this.handleWebSocketMessage(message);
                };
                
                this.ws.onclose = () => {
                    console.log('WebSocket disconnected');
                    this.updateConnectionStatus(false);
                    this.attemptReconnect();
                };
                
                this.ws.onerror = (error) => {
                    console.error('WebSocket error:', error);
                    this.updateConnectionStatus(false);
                };
            }
            
            attemptReconnect() {
                if (this.reconnectAttempts < this.maxReconnectAttempts) {
                    setTimeout(() => {
                        this.reconnectAttempts++;
                        console.log(`Reconnection attempt ${this.reconnectAttempts}`);
                        this.initializeWebSocket();
                    }, this.reconnectInterval);
                }
            }
            
            updateConnectionStatus(connected) {
                const statusEl = document.getElementById('connectionStatus');
                if (connected) {
                    statusEl.textContent = 'Connected';
                    statusEl.className = 'connection-status connected';
                } else {
                    statusEl.textContent = 'Disconnected';
                    statusEl.className = 'connection-status disconnected';
                }
            }
            
            handleWebSocketMessage(message) {
                switch (message.type) {
                    case 'initial_state':
                        this.updateSystemHealth(message.data);
                        break;
                    case 'system_health_update':
                        this.updateSystemHealth(message.data);
                        break;
                    case 'pipeline_status_update':
                        this.updateActivePipelines(message.data.active_pipelines);
                        break;
                    case 'metrics_update':
                        this.updateMetrics(message.data);
                        break;
                    case 'pipeline_manual_start':
                        this.showNotification(`Manual pipeline execution started: ${message.data.pipeline_type}`);
                        break;
                    case 'system_override':
                        this.showNotification(`System override: ${message.data.component} - ${message.data.reason}`, 'warning');
                        break;
                }
            }
            
            async loadInitialData() {
                // Initial data loading is now handled by widget refresh system
                setTimeout(() => {
                    this.refreshAllActiveWidgets();
                }, 1000);
            }
            
            refreshAllActiveWidgets() {
                this.widgetManager.widgets.forEach((widget, widgetId) => {
                    this.refreshSpecificWidget(widgetId);
                });
            }
            
            async loadSystemHealthWidget() {
                try {
                    const response = await fetch('/api/system/health');
                    const data = await response.json();
                    this.updateSystemHealthWidget(data);
                } catch (error) {
                    console.error('Failed to load system health:', error);
                    this.showWidgetError('system-health', 'Failed to load system health data');
                }
            }
            
            async loadActivePipelinesWidget() {
                try {
                    const response = await fetch('/api/pipelines/active');
                    const data = await response.json();
                    this.updateActivePipelinesWidget(data);
                } catch (error) {
                    console.error('Failed to load active pipelines:', error);
                    this.showWidgetError('active-pipelines', 'Failed to load pipeline data');
                }
            }
            
            async loadPerformanceMetricsWidget() {
                try {
                    const response = await fetch('/api/metrics/all');
                    const data = await response.json();
                    this.updatePerformanceMetricsWidget(data);
                } catch (error) {
                    console.error('Failed to load performance metrics:', error);
                    this.showWidgetError('performance-metrics', 'Failed to load metrics data');
                }
            }
            
            async loadRecentActivityWidget() {
                try {
                    const response = await fetch('/api/pipelines/recent?limit=5');
                    const data = await response.json();
                    this.updateRecentActivityWidget(data);
                } catch (error) {
                    console.error('Failed to load recent activity:', error);
                    this.showWidgetError('recent-activity', 'Failed to load activity data');
                }
            }
            
            async loadOpportunitiesWidget() {
                try {
                    // Mock data for opportunities - would connect to real API
                    const mockData = {
                        opportunities: [
                            {
                                game: 'Yankees vs Red Sox',
                                market: 'Moneyline',
                                recommendation: 'Strong Buy',
                                confidence: 0.85,
                                value: '+150',
                                timestamp: new Date().toISOString()
                            },
                            {
                                game: 'Dodgers vs Giants',
                                market: 'Total Over',
                                recommendation: 'Buy',
                                confidence: 0.72,
                                value: 'Over 9.5',
                                timestamp: new Date().toISOString()
                            }
                        ]
                    };
                    this.updateOpportunitiesWidget(mockData);
                } catch (error) {
                    console.error('Failed to load opportunities:', error);
                    this.showWidgetError('opportunities', 'Failed to load opportunities data');
                }
            }
            
            async loadLineMovementWidget() {
                try {
                    // Mock data for line movement - would connect to real API
                    const mockData = {
                        game: 'Live Game Movement',
                        movements: [
                            { book: 'DraftKings', from: -110, to: -115, timestamp: new Date() },
                            { book: 'FanDuel', from: -105, to: -108, timestamp: new Date() },
                            { book: 'BetMGM', from: -112, to: -118, timestamp: new Date() }
                        ]
                    };
                    this.updateLineMovementWidget(mockData);
                } catch (error) {
                    console.error('Failed to load line movement:', error);
                    this.showWidgetError('line-movement', 'Failed to load line movement data');
                }
            }
            
            async loadAlertsWidget() {
                try {
                    // Mock alerts - would connect to real monitoring system
                    const mockData = {
                        alerts: [
                            {
                                level: 'warning',
                                message: 'High CPU usage detected',
                                timestamp: new Date().toISOString()
                            },
                            {
                                level: 'info',
                                message: 'System update available',
                                timestamp: new Date().toISOString()
                            }
                        ]
                    };
                    this.updateAlertsWidget(mockData);
                } catch (error) {
                    console.error('Failed to load alerts:', error);
                    this.showWidgetError('alerts', 'Failed to load alerts data');
                }
            }
            
            async loadQuickStatsWidget() {
                try {
                    const metricsResponse = await fetch('/api/metrics/all');
                    const data = await metricsResponse.json();
                    
                    const quickStats = {
                        totalOpportunities: data.business_metrics?.opportunities_detected || 0,
                        successRate: '94.2%',
                        activeGames: Math.floor(Math.random() * 15) + 5,
                        totalValue: '$' + (Math.random() * 5000 + 1000).toFixed(2)
                    };
                    
                    this.updateQuickStatsWidget(quickStats);
                } catch (error) {
                    console.error('Failed to load quick stats:', error);
                    this.showWidgetError('quick-stats', 'Failed to load stats data');
                }
            }
            
            updateSystemHealthWidget(data) {
                const healthEl = document.getElementById('system-health');
                const statusEl = document.getElementById('systemStatus');
                
                if (healthEl) {
                    healthEl.innerHTML = `
                        <div class="metric">
                            <span>Overall Status</span>
                            <span class="metric-value">${data.overall_status}</span>
                        </div>
                        <div class="metric">
                            <span>Uptime</span>
                            <span class="metric-value">${Math.floor(data.uptime_seconds / 3600)}h ${Math.floor((data.uptime_seconds % 3600) / 60)}m</span>
                        </div>
                        <div class="metric">
                            <span>Active Pipelines</span>
                            <span class="metric-value">${data.active_pipelines}</span>
                        </div>
                        <div class="metric">
                            <span>Success Rate</span>
                            <span class="metric-value">${data.recent_success_rate.toFixed(1)}%</span>
                        </div>
                    `;
                }
                
                // Update header status
                if (statusEl) {
                    const statusClass = data.overall_status === 'healthy' ? 'status-healthy' : 
                                       data.overall_status === 'warning' ? 'status-warning' : 'status-critical';
                    statusEl.innerHTML = `
                        <span class="status-indicator ${statusClass}"></span>
                        <span>System ${data.overall_status}</span>
                    `;
                }
            }
            
            updateActivePipelinesWidget(pipelines) {
                const pipelinesEl = document.getElementById('active-pipelines');
                if (!pipelinesEl) return;
                
                if (!pipelines || pipelines.length === 0) {
                    pipelinesEl.innerHTML = '<div style="text-align: center; color: #6b7280;">No active pipelines</div>';
                    return;
                }
                
                pipelinesEl.innerHTML = pipelines.map(pipeline => `
                    <div class="list-item">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <strong>${pipeline.pipeline_type}</strong>
                            <span class="pipeline-status status-${pipeline.status}">${pipeline.status}</span>
                        </div>
                        <div style="font-size: 0.875rem; color: #9ca3af;">
                            Started: ${new Date(pipeline.start_time).toLocaleTimeString()}
                        </div>
                        <div style="font-size: 0.875rem; color: #9ca3af;">
                            Stages: ${pipeline.successful_stages}/${pipeline.stages_executed}
                        </div>
                    </div>
                `).join('');
            }
            
            updatePerformanceMetricsWidget(data) {
                const metricsEl = document.getElementById('performance-metrics');
                if (!metricsEl) return;
                
                metricsEl.innerHTML = `
                    <div class="metric">
                        <span>CPU Usage</span>
                        <span class="metric-value">${data.system_metrics.cpu_usage?.toFixed(1) || 0}%</span>
                    </div>
                    <div class="metric">
                        <span>Memory Usage</span>
                        <span class="metric-value">${data.system_metrics.memory_usage?.toFixed(1) || 0}%</span>
                    </div>
                    <div class="metric">
                        <span>Opportunities Found</span>
                        <span class="metric-value">${data.business_metrics.opportunities_detected || 0}</span>
                    </div>
                    <div class="metric">
                        <span>Total Value</span>
                        <span class="metric-value">$${data.business_metrics.total_value_identified?.toFixed(2) || 0}</span>
                    </div>
                `;
            }
            
            updateRecentActivityWidget(pipelines) {
                const activityEl = document.getElementById('recent-activity');
                if (!activityEl) return;
                
                if (!pipelines || pipelines.length === 0) {
                    activityEl.innerHTML = '<div style="text-align: center; color: #6b7280;">No recent activity</div>';
                    return;
                }
                
                activityEl.innerHTML = pipelines.map(pipeline => `
                    <div class="list-item">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <strong>${pipeline.pipeline_type}</strong>
                            <span class="pipeline-status status-${pipeline.status}">${pipeline.status}</span>
                        </div>
                        <div style="font-size: 0.875rem; color: #9ca3af;">
                            ${new Date(pipeline.start_time).toLocaleString()}
                        </div>
                        <div style="font-size: 0.875rem; color: #9ca3af;">
                            Duration: ${pipeline.execution_time_seconds.toFixed(2)}s
                        </div>
                    </div>
                `).join('');
            }
            
            updateOpportunitiesWidget(data) {
                const opportunitiesEl = document.getElementById('opportunities');
                if (!opportunitiesEl) return;
                
                if (!data.opportunities || data.opportunities.length === 0) {
                    opportunitiesEl.innerHTML = '<div style="text-align: center; color: #6b7280;">No opportunities detected</div>';
                    return;
                }
                
                opportunitiesEl.innerHTML = data.opportunities.map(opp => `
                    <div class="list-item" style="border-left: 4px solid #10b981;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <strong>${opp.game}</strong>
                            <span class="confidence-badge" style="background: #10b981; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.875rem;">
                                ${(opp.confidence * 100).toFixed(0)}%
                            </span>
                        </div>
                        <div style="font-size: 0.875rem; color: #9ca3af; margin-bottom: 0.25rem;">
                            Market: ${opp.market} | Value: ${opp.value}
                        </div>
                        <div style="font-size: 0.875rem;">
                            <span style="color: #10b981; font-weight: 600;">${opp.recommendation}</span>
                        </div>
                    </div>
                `).join('');
            }
            
            updateLineMovementWidget(data) {
                const lineEl = document.getElementById('line-movement');
                if (!lineEl) return;
                
                lineEl.innerHTML = `
                    <div style="margin-bottom: 1rem;">
                        <h4 style="color: #e2e8f0; margin-bottom: 0.5rem;">${data.game}</h4>
                        <div style="font-size: 0.875rem; color: #9ca3af;">Real-time line movement</div>
                    </div>
                    ${data.movements.map(movement => `
                        <div class="list-item" style="background: ${movement.to > movement.from ? '#7f1d1d' : '#065f46'};">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <strong>${movement.book}</strong>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span>${movement.from > 0 ? '+' : ''}${movement.from}</span>
                                    <span style="color: #9ca3af;">‚Üí</span>
                                    <span style="font-weight: bold;">${movement.to > 0 ? '+' : ''}${movement.to}</span>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                `;
            }
            
            updateAlertsWidget(data) {
                const alertsEl = document.getElementById('alerts');
                if (!alertsEl) return;
                
                if (!data.alerts || data.alerts.length === 0) {
                    alertsEl.innerHTML = '<div style="text-align: center; color: #6b7280;">No active alerts</div>';
                    return;
                }
                
                alertsEl.innerHTML = data.alerts.map(alert => `
                    <div class="alert-item ${alert.level}">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <div style="flex: 1;">
                                <div style="font-weight: 600; margin-bottom: 0.25rem;">
                                    ${alert.level.toUpperCase()}
                                </div>
                                <div>${alert.message}</div>
                            </div>
                            <div style="font-size: 0.75rem; opacity: 0.8;">
                                ${new Date(alert.timestamp).toLocaleTimeString()}
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            
            updateQuickStatsWidget(data) {
                const statsEl = document.getElementById('quick-stats');
                if (!statsEl) return;
                
                statsEl.innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; text-align: center;">
                        <div>
                            <div style="font-size: 1.5rem; font-weight: bold; color: #60a5fa;">${data.totalOpportunities}</div>
                            <div style="font-size: 0.75rem; color: #9ca3af;">Opportunities</div>
                        </div>
                        <div>
                            <div style="font-size: 1.5rem; font-weight: bold; color: #10b981;">${data.successRate}</div>
                            <div style="font-size: 0.75rem; color: #9ca3af;">Success Rate</div>
                        </div>
                        <div>
                            <div style="font-size: 1.5rem; font-weight: bold; color: #f59e0b;">${data.activeGames}</div>
                            <div style="font-size: 0.75rem; color: #9ca3af;">Active Games</div>
                        </div>
                        <div>
                            <div style="font-size: 1.5rem; font-weight: bold; color: #8b5cf6;">${data.totalValue}</div>
                            <div style="font-size: 0.75rem; color: #9ca3af;">Total Value</div>
                        </div>
                    </div>
                `;
            }
            
            showWidgetError(widgetId, message) {
                const widgetEl = document.getElementById(widgetId);
                if (widgetEl) {
                    widgetEl.innerHTML = `
                        <div style="text-align: center; color: #ef4444; padding: 2rem;">
                            <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">‚ö†Ô∏è</div>
                            <div>${message}</div>
                            <button onclick="window.dashboard.refreshSpecificWidget('${widgetId}')" 
                                    style="margin-top: 1rem; padding: 0.5rem 1rem; background: #374151; border: none; border-radius: 4px; color: #e2e8f0; cursor: pointer;">
                                Retry
                            </button>
                        </div>
                    `;
                }
            }
            
            updateActivePipelines(pipelines) {
                const pipelinesEl = document.getElementById('activePipelines');
                
                if (!pipelines || pipelines.length === 0) {
                    pipelinesEl.innerHTML = '<div style="text-align: center; color: #6b7280;">No active pipelines</div>';
                    return;
                }
                
                pipelinesEl.innerHTML = pipelines.map(pipeline => `
                    <div class="pipeline-item">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <strong>${pipeline.pipeline_type}</strong>
                            <span class="pipeline-status status-${pipeline.status}">${pipeline.status}</span>
                        </div>
                        <div style="font-size: 0.875rem; color: #9ca3af;">
                            Started: ${new Date(pipeline.start_time).toLocaleTimeString()}
                        </div>
                        <div style="font-size: 0.875rem; color: #9ca3af;">
                            Stages: ${pipeline.successful_stages}/${pipeline.stages_executed}
                        </div>
                    </div>
                `).join('');
            }
            
            updateMetrics(data) {
                const metricsEl = document.getElementById('performanceMetrics');
                
                metricsEl.innerHTML = `
                    <div class="metric">
                        <span>CPU Usage</span>
                        <span class="metric-value">${data.system_metrics.cpu_usage?.toFixed(1) || 0}%</span>
                    </div>
                    <div class="metric">
                        <span>Memory Usage</span>
                        <span class="metric-value">${data.system_metrics.memory_usage?.toFixed(1) || 0}%</span>
                    </div>
                    <div class="metric">
                        <span>Opportunities Found</span>
                        <span class="metric-value">${data.business_metrics.opportunities_detected || 0}</span>
                    </div>
                    <div class="metric">
                        <span>Total Value</span>
                        <span class="metric-value">$${data.business_metrics.total_value_identified?.toFixed(2) || 0}</span>
                    </div>
                `;
            }
            
            updateRecentActivity(pipelines) {
                const activityEl = document.getElementById('recentActivity');
                
                if (!pipelines || pipelines.length === 0) {
                    activityEl.innerHTML = '<div style="text-align: center; color: #6b7280;">No recent activity</div>';
                    return;
                }
                
                activityEl.innerHTML = pipelines.map(pipeline => `
                    <div class="pipeline-item">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <strong>${pipeline.pipeline_type}</strong>
                            <span class="pipeline-status status-${pipeline.status}">${pipeline.status}</span>
                        </div>
                        <div style="font-size: 0.875rem; color: #9ca3af;">
                            ${new Date(pipeline.start_time).toLocaleString()}
                        </div>
                        <div style="font-size: 0.875rem; color: #9ca3af;">
                            Duration: ${pipeline.execution_time_seconds.toFixed(2)}s
                        </div>
                    </div>
                `).join('');
            }
            
            showNotification(message, type = 'info') {
                // Simple notification system
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 80px;
                    right: 20px;
                    background: ${type === 'warning' ? '#f59e0b' : '#3b82f6'};
                    color: white;
                    padding: 1rem;
                    border-radius: 4px;
                    z-index: 1000;
                    max-width: 300px;
                `;
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 5000);
            }
        }
        
        // Initialize enhanced dashboard when page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.dashboard = new EnhancedMonitoringDashboard();
        });
    </script>
</body>
</html>