{
  "duplicates": {
    "total_games_with_duplicates": 20,
    "max_duplicates_per_game": 53,
    "sample_duplicates": [
      {
        "game": "SF vs CLE",
        "split_type": "moneyline",
        "source": "SBD",
        "book": null,
        "duplicate_count": 53
      },
      {
        "game": "SEA vs BOS",
        "split_type": "total",
        "source": "SBD",
        "book": null,
        "duplicate_count": 53
      },
      {
        "game": "TOR vs ARI",
        "split_type": "moneyline",
        "source": "SBD",
        "book": null,
        "duplicate_count": 53
      },
      {
        "game": "LAD vs SD",
        "split_type": "moneyline",
        "source": "SBD",
        "book": null,
        "duplicate_count": 53
      },
      {
        "game": "OAK vs HOU",
        "split_type": "total",
        "source": "SBD",
        "book": null,
        "duplicate_count": 53
      },
      {
        "game": "NYY vs LAA",
        "split_type": "total",
        "source": "SBD",
        "book": null,
        "duplicate_count": 53
      },
      {
        "game": "NYY vs LAA",
        "split_type": "moneyline",
        "source": "SBD",
        "book": null,
        "duplicate_count": 53
      },
      {
        "game": "CIN vs MIN",
        "split_type": "total",
        "source": "SBD",
        "book": null,
        "duplicate_count": 53
      },
      {
        "game": "SF vs CLE",
        "split_type": "total",
        "source": "SBD",
        "book": null,
        "duplicate_count": 53
      },
      {
        "game": "SEA vs BOS",
        "split_type": "moneyline",
        "source": "SBD",
        "book": null,
        "duplicate_count": 53
      }
    ]
  },
  "data_sources": [
    {
      "source": "SBD",
      "book": null,
      "total_records": 2974,
      "unique_games": 60,
      "avg_records_per_game": 49.6,
      "is_problematic": true
    },
    {
      "source": "VSIN",
      "book": "circa",
      "total_records": 1071,
      "unique_games": 43,
      "avg_records_per_game": 24.9,
      "is_problematic": true
    },
    {
      "source": "VSIN",
      "book": "draftkings",
      "total_records": 1109,
      "unique_games": 48,
      "avg_records_per_game": 23.1,
      "is_problematic": true
    }
  ],
  "performance_impact": [
    {
      "source_book_type": "SBD-None",
      "split_type": "moneyline",
      "raw_bets": 898,
      "dedup_bets": 57,
      "excess_bets": 841,
      "raw_qualifying": 325,
      "dedup_qualifying": 20,
      "excess_qualifying": 305
    },
    {
      "source_book_type": "SBD-None",
      "split_type": "total",
      "raw_bets": 893,
      "dedup_bets": 54,
      "excess_bets": 839,
      "raw_qualifying": 66,
      "dedup_qualifying": 7,
      "excess_qualifying": 59
    },
    {
      "source_book_type": "SBD-None",
      "split_type": "spread",
      "raw_bets": 826,
      "dedup_bets": 49,
      "excess_bets": 777,
      "raw_qualifying": 338,
      "dedup_qualifying": 14,
      "excess_qualifying": 324
    },
    {
      "source_book_type": "VSIN-draftkings",
      "split_type": "moneyline",
      "raw_bets": 340,
      "dedup_bets": 42,
      "excess_bets": 298,
      "raw_qualifying": 168,
      "dedup_qualifying": 20,
      "excess_qualifying": 148
    },
    {
      "source_book_type": "VSIN-draftkings",
      "split_type": "spread",
      "raw_bets": 313,
      "dedup_bets": 42,
      "excess_bets": 271,
      "raw_qualifying": 223,
      "dedup_qualifying": 27,
      "excess_qualifying": 196
    },
    {
      "source_book_type": "VSIN-circa",
      "split_type": "spread",
      "raw_bets": 235,
      "dedup_bets": 39,
      "excess_bets": 196,
      "raw_qualifying": 69,
      "dedup_qualifying": 14,
      "excess_qualifying": 55
    },
    {
      "source_book_type": "VSIN-circa",
      "split_type": "moneyline",
      "raw_bets": 235,
      "dedup_bets": 39,
      "excess_bets": 196,
      "raw_qualifying": 131,
      "dedup_qualifying": 26,
      "excess_qualifying": 105
    },
    {
      "source_book_type": "VSIN-circa",
      "split_type": "total",
      "raw_bets": 112,
      "dedup_bets": 14,
      "excess_bets": 98,
      "raw_qualifying": 20,
      "dedup_qualifying": 7,
      "excess_qualifying": 13
    },
    {
      "source_book_type": "VSIN-draftkings",
      "split_type": "total",
      "raw_bets": 94,
      "dedup_bets": 13,
      "excess_bets": 81,
      "raw_qualifying": 61,
      "dedup_qualifying": 11,
      "excess_qualifying": 50
    }
  ],
  "total_excess_bets": 3597,
  "recommendations": [
    {
      "priority": "HIGH",
      "title": "Add Database Constraints",
      "description": "Prevent duplicate entries at database level",
      "sql": "\n                ALTER TABLE mlb_betting.splits.raw_mlb_betting_splits \n                ADD CONSTRAINT unique_game_split_daily \n                UNIQUE (game_id, split_type, source, book, DATE(last_updated))\n                "
    },
    {
      "priority": "HIGH",
      "title": "Update Data Collection Logic",
      "description": "Only capture data 5 minutes before first pitch",
      "implementation": "Modify scrapers to filter by timing: EXTRACT(EPOCH FROM (game_datetime - CURRENT_TIMESTAMP)) / 60 BETWEEN 4 AND 6"
    },
    {
      "priority": "HIGH",
      "title": "Use Deduplication View",
      "description": "Update all analysis queries to use betting_splits_deduplicated view",
      "implementation": "Replace references to raw_mlb_betting_splits with betting_splits_deduplicated in analysis scripts"
    }
  ]
}